### search_filters = {FOCUS_FILTER_POLITICAL}
### search_filters = {FOCUS_FILTER_RESEARCH}
### search_filters = {FOCUS_FILTER_INDUSTRY}
### search_filters = {FOCUS_FILTER_STABILITY}
### search_filters = {FOCUS_FILTER_WAR_SUPPORT}
### search_filters = {FOCUS_FILTER_MANPOWER}
### search_filters = {FOCUS_FILTER_ANNEXATION}
### search_filters = {FOCUS_FILTER_SPA_CIVIL_WAR}
### search_filters = {FOCUS_FILTER_SPA_CARLIST_UPRISING}
### search_filters = {FOCUS_FILTER_SPA_ANARCHIST_UPRISING}

focus_tree = {
    id = JFU_RSPAIN_focus
	country = {	factor = 0
		modifier = {
			add = 10
			tag = SPA
		}
		} 
	default = no 
	continuous_focus_position = { x = 20 y = 2000 }


	focus = {
		id = SPA_the_popular_front
		available = {
		}
		
		bypass = {
			has_global_flag = spanish_civil_war
		}
		cancel_if_invalid = yes
		
		icon = GFX_goal_generic_national_unity
		x = 10
		y = 0
		cost = 40

		available_if_capitulated = yes
		search_filters = {FOCUS_FILTER_POLITICAL}
		completion_reward = {
			add_popularity = {
			    ideology = communism
			    popularity = 0.1
			}
			add_popularity = {
			    ideology = neutrality
			    popularity = 0.05
			}
		}
	}
	focus = {
		id = SPA_maintain_the_second_republic
		available = {
			has_global_flag = spanish_civil_war
			hidden_trigger = { always = no }
		}
		bypass = {
		}
		prerequisite = { focus = SPA_the_popular_front }
		
		icon = GFX_focus_spr_maintain_the_republic
		x = 0
		y = 1
		relative_position_id = SPA_the_popular_front
		cost = 5

		available_if_capitulated = yes
		search_filters = {FOCUS_FILTER_POLITICAL FOCUS_FILTER_WAR_SUPPORT}
		completion_reward = {
			add_political_power = 60
			add_war_support = 0.05
			custom_effect_tooltip = available_military_high_command
			show_ideas_tooltip = SPR_antonio_escobar_huerta
		}
	}
	focus = {
		id = SPA_new_leadership
		available = {
		}
		bypass = {
			has_global_flag = scw_over
		}
		prerequisite = { focus = SPA_maintain_the_second_republic }

		icon = GFX_goal_generic_intelligence_exchange
		x = -1
		y = 1
		relative_position_id = SPA_maintain_the_second_republic
		cost = 10

		available_if_capitulated = yes
		search_filters = {FOCUS_FILTER_STABILITY}
		completion_reward = {
			add_stability = 0.05
			custom_effect_tooltip = available_political_advisor
			show_ideas_tooltip = SPR_jesus_hernandez_tomas
		}
	}
	focus = {
		id = SPA_the_future_of_the_republic
		available = {
		}
		bypass = {
			has_global_flag = scw_over
		}
		prerequisite = { focus = SPA_new_leadership }

		icon = GFX_goal_support_democracy
		x = 0
		y = 1
		relative_position_id = SPA_new_leadership
		cost = 10

		available_if_capitulated = yes
		search_filters = {FOCUS_FILTER_POLITICAL}
		completion_reward = {
			add_political_power = 200
		}
	}
	focus = {
		id = SPA_petition_for_french_aid
		available = {
			NOT = { has_war_with = FRA }
			NOT = { has_global_flag = scw_over }
			FRA = {
				OR = {
					has_government = democratic
					has_government = communism
				}
			}
		}
		bypass = {
		}
		prerequisite = { focus = SPA_the_future_of_the_republic }

		icon = GFX_focus_chi_reach_out_to_france
		x = 0
		y = 1
		relative_position_id = SPA_the_future_of_the_republic
		cost = 10

		available_if_capitulated = yes
		search_filters = {FOCUS_FILTER_WAR_SUPPORT}

		completion_reward = {
			effect_tooltip = {
				add_war_support = 0.15
				FRA = {
					add_timed_idea = { idea = SPR_equipment_shipments days = 730 }
					add_opinion_modifier = { target = ROOT modifier = SPA_spanish_civil_war_commitments }
				}
			}
			custom_effect_tooltip = SPR_petition_for_french_aid_tt
		}
	}

	focus = {
		id = SPA_reaffirm_the_popular_front_strategy
		available = {
		}
		bypass = {
			OR = {
				has_global_flag = SPR_anarchist_uprising_flag
				has_global_flag = scw_over
			}
		}
		prerequisite = { focus = SPA_the_future_of_the_republic }
		
		icon = GFX_goal_generic_propaganda
		x = -2
		y = 1
		relative_position_id = SPA_the_future_of_the_republic
		cost = 5

		available_if_capitulated = yes
		search_filters = {FOCUS_FILTER_WAR_SUPPORT FOCUS_FILTER_POLITICAL}
		completion_reward = {
			add_war_support = 0.05
			add_timed_idea = { idea = SPR_popular_front_1 days = 730 }
		}
	}

	focus = {
		id = SPA_crush_the_revolution
		available = {
		}
		prerequisite = { focus = SPA_reaffirm_the_popular_front_strategy }
		
		icon = GFX_focus_spr_crush_the_revolution
		x = 0
		y = 1
		relative_position_id = SPA_reaffirm_the_popular_front_strategy
		cost = 5

		available_if_capitulated = yes
		search_filters = {FOCUS_FILTER_STABILITY FOCUS_FILTER_SPA_CIVIL_WAR}
		completion_reward = {
			custom_effect_tooltip = remove_political_advisor
			show_ideas_tooltip = SPR_jesus_hernandez_tomas
			add_timed_idea = { idea = SPR_crush_the_revolution days = 60 }
			swap_ideas = {
				remove_idea = SPR_popular_front_1
				add_idea = SPR_popular_front_2
			}
			custom_effect_tooltip = SPR_crush_the_revolution_tt
			hidden_effect = { country_event = lar_spain.9 }
		}
	}

	focus = {
		id = SPA_relocate_the_gold_reserves
		available = {
		}
		bypass = {
			OR = {
				has_global_flag = scw_over
				has_global_flag = SPR_gold_reserves_flag
			}
		}
		prerequisite = {  focus = SPA_the_future_of_the_republic }
		
		icon = GFX_focus_usa_reestablish_the_gold_standard
		x = -4
		y = 1
		relative_position_id = SPA_the_future_of_the_republic
		cost = 5

		available_if_capitulated = yes
		search_filters = {FOCUS_FILTER_INDUSTRY}
		completion_reward = {
			add_stability = -0.05
			add_ideas = SPR_relocate_the_gold_reserves
			custom_effect_tooltip = SPR_relocate_the_gold_reserves_tt
			country_event = lar_spain.51
			set_global_flag = SPR_gold_reserves_flag
		}
	}
	focus = {
		id = SPA_strengthen_the_euzko_gudarostea
		available = {
			has_full_control_of_state = 792
			NOT = { has_global_flag = scw_over }
		}
		bypass = {
		}
		prerequisite = {  focus = SPA_maintain_the_second_republic }
		
		icon = GFX_goal_generic_allies_build_infantry
		x = -3
		y = 1
		relative_position_id = SPA_maintain_the_second_republic
		cost = 5

		available_if_capitulated = yes
		search_filters = {FOCUS_FILTER_SPA_CIVIL_WAR}
		completion_reward = {
			custom_effect_tooltip = SPR_strengthen_the_euzko_gudarostea_tt
			hidden_effect = {
				division_template = {
					name = "Euzko Gudarosteko Eskuadroia"
					priority = 1
					division_names_group = SPD_INF_05
					regiments = {
						infantry = { x = 0 y = 0 }
						infantry = { x = 0 y = 1 }
						infantry = { x = 0 y = 2 }
					}
				}
				# Basque
				792 = {
					create_unit = {
						division = "division_template = \"Euzko Gudarosteko Eskuadroia\" start_experience_factor = 0.1" 
						owner = ROOT
					}
					create_unit = {
						division = "division_template = \"Euzko Gudarosteko Eskuadroia\" start_experience_factor = 0.1" 
						owner = ROOT
					}
					create_unit = {
						division = "division_template = \"Euzko Gudarosteko Eskuadroia\" start_experience_factor = 0.1" 
						owner = ROOT
					}
					create_unit = {
						division = "division_template = \"Euzko Gudarosteko Eskuadroia\" start_experience_factor = 0.1" 
						owner = ROOT
					}
					create_unit = {
						division = "division_template = \"Euzko Gudarosteko Eskuadroia\" start_experience_factor = 0.1" 
						owner = ROOT
					}
					create_unit = {
						division = "division_template = \"Euzko Gudarosteko Eskuadroia\" start_experience_factor = 0.1" 
						owner = ROOT
					}
				}
			}
		}
	}
	focus = {
		id = SPA_fortify_the_iron_ring
		available = {
			has_full_control_of_state = 792
			NOT = { has_global_flag = scw_over }
		}
		bypass = {
		}
		prerequisite = { focus = SPA_strengthen_the_euzko_gudarostea }
		
		icon = GFX_goal_generic_fortify_city
		x = 0
		y = 1
		relative_position_id = SPA_strengthen_the_euzko_gudarostea
		cost = 5

		available_if_capitulated = yes

		completion_reward = {
			add_timed_idea = { idea = SPR_fortify_the_iron_ring days = 730 }
			792 = {
				add_building_construction = {
					type = bunker
					province = {
						id = 740
					}
					level = 3
					instant_build = yes
				}
			}
		}
	}
	focus = {
		id = SPA_ensure_loyalty
		available = {
		}
		bypass = {
			has_global_flag = scw_over
		}
		prerequisite = { focus = SPA_maintain_the_second_republic }

		icon = GFX_goal_generic_political_pressure
		x = 1
		y = 1
		relative_position_id = SPA_maintain_the_second_republic
		cost = 10

		available_if_capitulated = yes
		search_filters = {FOCUS_FILTER_STABILITY}

		completion_reward = {
			add_stability = 0.1
		}
	}

	focus = {
		id = SPA_enlist_the_carabineros
		bypass = {
			has_global_flag = scw_over
		}
		prerequisite = { focus = SPA_maintain_the_second_republic }

		icon = GFX_goal_generic_military_sphere
		x = 3
		y = 1
		relative_position_id = SPA_maintain_the_second_republic
		cost = 5

		available_if_capitulated = yes

		completion_reward = {
			custom_effect_tooltip = SPR_enlist_the_carabineros_tt
			custom_effect_tooltip = SPR_remove_after_civil_war_tt
			hidden_effect = {
				division_template = {
					name = "Carabineros"
					template_counter = 3
					priority = 1
					division_names_group = SPR_INF_01
					is_locked = yes
					regiments = {
						infantry = { x = 0 y = 0 }
						infantry = { x = 0 y = 1 }
						infantry = { x = 0 y = 2 }
					}
				}
				random_owned_controlled_state = {
					limit = {
						is_in_home_area = yes
					}
					create_unit = {
						division = "name = \"1. Carabineros\" division_template = \"Carabineros\" start_experience_factor = 0.1" 
						owner = ROOT
					}
				}
				random_owned_controlled_state = {
					limit = {
						is_in_home_area = yes
					}
					create_unit = {
						division = "name = \"2. Carabineros\" division_template = \"Carabineros\" start_experience_factor = 0.1" 
						owner = ROOT
					}
				}
				random_owned_controlled_state = {
					limit = {
						is_in_home_area = yes
					}
					create_unit = {
						division = "name = \"3. Carabineros\" division_template = \"Carabineros\" start_experience_factor = 0.1" 
						owner = ROOT
					}
				}
				random_owned_controlled_state = {
					limit = {
						is_in_home_area = yes
					}
					create_unit = {
						division = "name = \"4. Carabineros\" division_template = \"Carabineros\" start_experience_factor = 0.1" 
						owner = ROOT
					}
				}
				random_owned_controlled_state = {
					limit = {
						is_in_home_area = yes
					}
					create_unit = {
						division = "name = \"5. Carabineros\" division_template = \"Carabineros\" start_experience_factor = 0.1" 
						owner = ROOT
					}
				}
			}
		}
	}

	focus = {
		id = SPA_the_popular_army
		available = {
		}
		bypass = {
		}
		prerequisite = { focus = SPA_ensure_loyalty }
		prerequisite = { focus = SPA_enlist_the_carabineros }

		icon = GFX_focus_generic_support_the_left_right
		x = 1
		y = 1
		relative_position_id = SPA_ensure_loyalty
		cost = 10

		available_if_capitulated = yes

		search_filters = {FOCUS_FILTER_RESEARCH}

		completion_reward = {
			remove_ideas = SPR_disbanded_army_1
			add_tech_bonus = {
				name = SPR_the_popular_army
				bonus = 1
				uses = 1
				category = infantry_weapons
			}
			add_doctrine_cost_reduction = {
				name = SPR_the_popular_army
				cost_reduction = 0.5
				uses = 1
				category = land_doctrine
			}
		}
	}

	focus = {
		id = SPA_take_the_initiative
		available = {
			NOT = { has_global_flag = scw_over }
		}
		bypass = {
		}
		prerequisite = { focus = SPA_the_popular_army }

		icon = GFX_goal_generic_major_war
		x = -1
		y = 1
		relative_position_id = SPA_the_popular_army
		cost = 5

		available_if_capitulated = yes

		completion_reward = {
			custom_effect_tooltip = SPA_tackle_the_vulnerable_fronts_tt
		}
	}

	focus = {
		id = SPA_expand_soviet_aid
		available = {
			NOT = { has_war_with = SOV }
			NOT = { has_global_flag = scw_over }
			SOV = { has_government = communism }
			has_volunteers_amount_from = {
			    tag = SOV
			    count > 0
			}
		}
		prerequisite = { focus = SPA_relocate_the_gold_reserves }
		prerequisite = { focus = SPA_crush_the_revolution }
		
		icon = GFX_goal_support_communism
		x = 1
		y = 2
		relative_position_id = SPA_relocate_the_gold_reserves
		cost = 5

		ai_will_do = {
			base = 1
			modifier = {
				factor = 3
				is_historical_focus_on = no
				SOV = {
					is_ai = no
				}
			}
			modifier = {
				factor = 3
				surrender_progress > 0.4
				is_historical_focus_on = no
			}
			modifier = {
				factor = 0
				is_historical_focus_on = yes
				SOV = {
					is_ai = yes
				}
			}
			modifier = {
				factor = 0
				surrender_progress < 0.4
				any_country = {
					NOT = { tag = SOV }
					ROOT = {
						has_volunteers_amount_from = {
						    tag = PREV
						    count > 0
						}
					}
				}
			}
		}

		available_if_capitulated = yes

		completion_reward = {
			add_popularity = {
			    ideology = communism
			    popularity = 0.05
			}
			custom_effect_tooltip = SPR_expand_soviet_aid_tt
		}
	}
}







